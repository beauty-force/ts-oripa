import{H as b,a as n,u as w,r as m,o as a,c as d,b as g,w as x,F as p,d as t,h as l,f as v,n as _,t as c,I as k}from"./app.0cc3647d.js";import{A as N}from"./UserLayout.1a8ae808.js";import{u as U}from"./useConfirm.ee4d26af.js";import{_ as P}from"./_plugin-vue_export-helper.cdc0426e.js";import"./index.75810fad.js";const{confirm:A}=U(),R={components:{Head:b,AdminLayout:N},props:{registeredCards:Array,point:Object,coupon_id:Number},data(){return{selectedCard:null,isNewCard:!1,loading:!1,cardPaymentUrl:"user.point.card_payment_post",registerCardUrl:"user.point.card_register",paymentRegisterUrl:"user.point.paymentRegister",deleteCardUrl:"user.point.deleteCard",purchaseSuccessUrl:"purchase_success",cards:this.registeredCards}},methods:{selectRegisteredCard(e){this.selectedCard=e.id,this.isNewCard=!1},newCardPayment(){this.selectedCard=null,this.isNewCard=!0},registerNewCard(){this.loading=!0,this.selectedCard=null,this.isNewCard=!1,n.get(route(this.registerCardUrl,{type:"purchase"})).then(e=>{e.data.status==1&&(window.location.href=e.data.link_url)})},proceedToPayment(){this.loading=!0,this.selectedCard?n.post(route(this.cardPaymentUrl),{card_id:this.selectedCard,id:this.point.id,coupon_id:this.coupon_id}).then(e=>{e.data.status=="CAPTURED"?window.location.href=this.purchaseSuccessUrl:e.data.status=="AUTHENTICATED"&&(window.location.href=e.data.acs_url)}).finally(()=>{this.loading=!1}):this.isNewCard&&n.post(route(this.paymentRegisterUrl),{id:this.point.id,pay_type:"Card",coupon_id:this.coupon_id}).then(e=>{e.data.status==0?alert(e.data.message):window.location.href=e.data.link_url})},deleteCard(e){A("\u3053\u306E\u30AB\u30FC\u30C9\u3092\u524A\u9664\u3057\u3066\u3082\u3088\u308D\u3057\u3044\u3067\u3059\u304B\uFF1F","","error").then(o=>{o&&(this.loading=!0,n.post(route(this.deleteCardUrl),{card_id:e}).then(u=>{u.data.status==1&&(this.cards=this.cards.filter(h=>h.id!=e))}).finally(()=>{this.loading=!1}))})},getCardBrandIcon(e){return`/images/credit_cards/${e.toLowerCase()}.svg`},formatCardNumber(e){return e.replace(/(.{4})/g,"$1 ").trim()},formatExpireDate(e){return`${e.slice(0,2)}/${e.slice(2)}`}},mounted(){var e;((e=w().props.value.auth.user)==null?void 0:e.type)==1&&(this.cardPaymentUrl="test.user.point.card_payment_post",this.registerCardUrl="test.user.point.card_register",this.paymentRegisterUrl="test.user.point.paymentRegister",this.deleteCardUrl="test.user.point.deleteCard",this.purchaseSuccessUrl="test.purchase_success")}},T={class:"flex justify-center items-center flex-1 bg-white py-2"},B={class:"p-6 w-full max-w-md"},E=t("h2",{class:"text-center text-xl font-semibold text-gray-800 mb-7"}," \u30AB\u30FC\u30C9\u6C7A\u6E08 ",-1),H={key:0,class:"fixed inset-0 flex justify-center items-center bg-gray-800 bg-opacity-75 z-[20]"},L=t("div",{class:"w-16 h-16 bg-white p-4 rounded-full shadow-lg"},[t("svg",{class:"animate-spin h-8 w-8 text-sky-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})])],-1),j=[L],D={key:1,class:"mb-6"},S=t("h3",{class:"text-lg font-bold mb-3"},"\u767B\u9332\u6E08\u307F\u30AB\u30FC\u30C9",-1),z=["onClick"],I={class:"flex items-center gap-4"},V=["src","alt"],F={class:"text-sm font-semibold text-gray-800"},M={class:"text-xs text-gray-500"},O={class:"text-xs text-gray-500"},q=["onClick"],G={key:2,class:"mb-6"},J=t("h3",{class:"text-lg font-bold mb-3"},"\u4ED6\u306E\u30AB\u30FC\u30C9\u3067\u304A\u652F\u6255\u3044",-1),K=["disabled"],Q={key:3,class:"mt-6"},W=t("h3",{class:"text-lg font-bold mb-3"},"\u65B0\u3057\u3044\u30AB\u30FC\u30C9\u3092\u767B\u9332\u3059\u308B",-1);function X(e,o,u,h,r,i){const f=m("Head"),y=m("AdminLayout");return a(),d(p,null,[g(f,{title:"\u30AB\u30FC\u30C9\u6C7A\u6E08"}),g(y,null,{default:x(()=>[t("div",T,[t("div",B,[E,r.loading?(a(),d("div",H,j)):l("",!0),!r.loading&&r.cards.length?(a(),d("div",D,[S,(a(!0),d(p,null,v(r.cards,(s,Y)=>(a(),d("div",{key:s.id,class:"mb-4"},[t("div",{onClick:C=>i.selectRegisteredCard(s),class:_([{"border-sky-500 bg-sky-100 font-bold":r.selectedCard===s.id,"hover:bg-gray-100 hover:border-gray-300":r.selectedCard!==s.id},"w-full p-4 bg-white border-2 border-gray-200 rounded-lg flex justify-between items-center transition duration-200 cursor-pointer"])},[t("div",I,[t("img",{src:i.getCardBrandIcon(s.brand),alt:s.brand,class:"w-16"},null,8,V),t("div",null,[t("p",F,c(i.formatCardNumber(s.card_no)),1),t("p",M," \u6709\u52B9\u671F\u9650: "+c(i.formatExpireDate(s.expire)),1),t("p",O," \u540D\u7FA9\u4EBA: "+c(s.holder_name),1)])]),t("button",{onClick:k(C=>i.deleteCard(s.id),["stop"]),class:"text-red-500 hover:text-red-700 text-sm font-semibold"}," \u524A\u9664 ",8,q)],10,z)]))),128))])):l("",!0),r.loading?l("",!0):(a(),d("div",G,[J,t("button",{onClick:o[0]||(o[0]=(...s)=>i.newCardPayment&&i.newCardPayment(...s)),class:_([{"border-sky-500 bg-sky-100 font-bold":r.isNewCard,"hover:bg-gray-100 hover:border-gray-300":!r.isNewCard},"w-full p-4 bg-white border-2 border-gray-200 rounded-lg flex justify-center items-center transition duration-200"])}," \u30AB\u30FC\u30C9\u60C5\u5831\u3092\u5165\u529B ",2)])),t("button",{type:"submit",disabled:!r.selectedCard&&!r.isNewCard||r.loading,onClick:o[1]||(o[1]=(...s)=>i.proceedToPayment&&i.proceedToPayment(...s)),class:"w-full p-4 bg-sky-500 text-white rounded-lg text-lg font-semibold transition duration-200 hover:bg-sky-600 my-4 disabled:opacity-50 disabled:cursor-not-allowed"}," \u652F\u6255\u3044\u3092\u7D9A\u3051\u308B ",8,K),r.loading?l("",!0):(a(),d("div",Q,[W,t("button",{onClick:o[2]||(o[2]=(...s)=>i.registerNewCard&&i.registerNewCard(...s)),class:"w-full p-4 bg-orange-500 text-white rounded-lg text-lg font-semibold transition duration-200 hover:bg-orange-600 my-4 disabled:opacity-50 disabled:cursor-not-allowed"}," \u65B0\u3057\u3044\u30AB\u30FC\u30C9\u3092\u767B\u9332 ")]))])])]),_:1})],64)}const re=P(R,[["render",X]]);export{re as default};
