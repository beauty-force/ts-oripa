import{o as a,c as i,d as e,H as T,L as N,a as S,r as b,b as f,w as M,F as L,t as P,h as d,I as j,f as E,n as I,J as R,a1 as B,e as z}from"./app.ac5a6315.js";import{A as O}from"./UserLayout.fe321fe6.js";import{_ as D}from"./Loading.70ba073f.js";import{u as V}from"./useConfirm.a405427d.js";import{_ as G}from"./_plugin-vue_export-helper.cdc0426e.js";import"./index.b5176747.js";function J(t,s){return a(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})])}const H=3,U="merchant.com.\u30C8\u30EC\u3057\u308B\u30AA\u30EA\u30D1",Y="apple-pay-button",q=route("apple_pay_validate"),{confirm:Je,alert:u}=V(),F={components:{Head:T,AdminLayout:O,Link:N,ArrowLeftIcon:J,Loading:D},props:{errors:Object,auth:Object,point:Object,is_admin:Number,amount:Number,amount_str:String,supported_pay_type:Object,rank:Object,coupon_id:Number,no_applepay_support:String,no_applepay_setting:String},data(){return{selectedMethod:null,agreeTerms:!1,loading:!1,payment_stage:"register",pay_type_titles:{Card:"\u30AF\u30EC\u30B8\u30C3\u30C8\u30AB\u30FC\u30C9",Paypay:"PayPay",Konbini:"\u30B3\u30F3\u30D3\u30CB\u6255\u3044",Virtualaccount:"\u9280\u884C\u632F\u8FBC",Applepay:"Apple Pay",amazonpay:"Amazon Pay",Googlepay:"Google Pay"}}},methods:{selectPaymentMethod(t){this.selectedMethod=t},handleSubmit(){if(!this.selectedMethod){u("\u652F\u6255\u3044\u65B9\u6CD5\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044");return}if(!this.agreeTerms){u("\u500B\u4EBA\u60C5\u5831\u306E\u53D6\u308A\u6271\u3044\u306B\u540C\u610F\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059");return}if(!this.supported_pay_type.includes(this.selectedMethod)){u("\u3053\u306E\u652F\u6255\u3044\u65B9\u6CD5\u306F\u8FD1\u3005\u5B9F\u88C5\u3055\u308C\u308B\u4E88\u5B9A\u3067\u3059\u3002");return}if(this.selectedMethod=="Applepay"&&!window.ApplePaySession){u(this.no_applepay_support,"","error");return}this.paymentRegister(this.selectedMethod)},submit(){},format_number(t){return String(t).replace(/(.)(?=(\d{3})+$)/g,"$1,")},paymentRegister(t){this.loading=!0,S.post(this.is_admin==1?route("test.user.point.paymentRegister"):route("user.point.paymentRegister"),{id:this.point.id,pay_type:t,coupon_id:this.coupon_id}).then(s=>{if(s.data.status==0)u(s.data.message);else if(t=="Card"||t=="Paypay"||t=="Konbini"||t=="Virtualaccount")s.data.status&&(window.location.href=s.data.link_url);else if(t=="Applepay")this.payment_stage="Applepay",this.$nextTick(()=>{const n=document.getElementById("applepay_container");n.innerHTML="",window.ApplePaySession?ApplePaySession.canMakePaymentsWithActiveCard(U).then(r=>{if(r){const c=document.createElement("button");c.setAttribute("id",Y),c.setAttribute("lang","ja-JP");const w="buy",k="#d68d2f";c.setAttribute("style",`-webkit-appearance: -apple-pay-button;
                                                -apple-pay-button-type: ${w};
                                                -apple-pay-button-style: ${k};
                                                width: 220px;
                                                height: 48px;
                                                text-align: center;
                                                font-size: 18px;
                                                border-radius: 5px;
                                                `),n.appendChild(c),c.addEventListener("click",v=>{const h={countryCode:"JP",currencyCode:"JPY",supportedNetworks:["visa","masterCard","jcb","amex"],merchantCapabilities:["supports3DS"],total:{label:s.data.response.label,amount:s.data.response.amount}},l=new ApplePaySession(H,h);l.onvalidatemerchant=o=>{const y=o.validationURL;fetch(q,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({validationURL:y})}).then(m=>m.json()).then(m=>{l.completeMerchantValidation(m)})},l.oncancel=o=>{},l.onpaymentauthorized=o=>{const y=o.payment.token;l.completePayment(ApplePaySession.STATUS_SUCCESS);const m=btoa(JSON.stringify(y.paymentData));S.post(this.is_admin==1?route("test.user.point.paymentExecute"):route("user.point.paymentExecute"),{pay_type:t,order_id:s.data.response.id,access_id:s.data.response.access_id,token:m}).then(g=>{g.data.status==0?u(g.data.message):window.location.href=g.data.redirect_uri})},l.begin()})}else n.innerHTML=this.no_applepay_setting}):n.innerHTML=this.no_applepay_support});else if(t=="Googlepay"){const n=document.createElement("script");n.src="https://pay.google.com/gp/p/js/pay.js",n.onload=this.renderGooglePayButton.bind(this,s.data.response),document.head.appendChild(n)}else if(t=="amazonpay"){this.payment_stage="amazonpay";const n=document.createElement("script");n.src="https://static-fe.payments-amazon.com/checkout.js",n.onload=this.renderAmazonPayButton.bind(this,s.data.response),document.head.appendChild(n)}this.loading=!1})},renderAmazonPayButton(t){this.loading=!1,amazon.Pay.renderButton("#amazonpay_container",{merchantId:t.merchant_id,publicKeyId:t.public_key_id,ledgerCurrency:"JPY",checkoutLanguage:"ja_JP",productType:"PayOnly",placement:"Checkout",buttonColor:"Gold",buttonWidth:"300px",buttonHeight:"50px",createCheckoutSessionConfig:{payloadJSON:JSON.stringify(t.payload),signature:t.signature,algorithm:"AMZN-PAY-RSASSA-PSS-V2"}})},renderGooglePayButton(t){this.loading=!1,this.payment_stage="Googlepay";const s=new google.payments.api.PaymentsClient({environment:t.google_pay_environment}),n={apiVersion:2,apiVersionMinor:0},x={type:"PAYMENT_GATEWAY",parameters:{gateway:"fincode",gatewayMerchantId:t.shop_id}},r={merchantId:t.google_pay_merchant_id,merchantName:t.google_pay_merchant_name},c=p=>({currencyCode:"JPY",totalPrice:p,totalPriceStatus:"FINAL"}),h={type:"CARD",parameters:{allowedAuthMethods:["PAN_ONLY"],allowedCardNetworks:["VISA","MASTERCARD","JCB","AMEX","DISCOVER"],billingAddressParameters:{format:"FULL",phoneNumberRequired:!0}}},l=Object.assign({tokenizationSpecification:x},h),o=Object.assign({},n);o.allowedPaymentMethods=[l],o.transactionInfo=c(t.amount),o.merchantInfo=r;const y=(p,_)=>{const A=s.createButton({onClick:_,buttonColor:"default",buttonType:"long"});p.appendChild(A)},m=async()=>{try{const _=(await s.loadPaymentData(o)).paymentMethodData.tokenizationData.token,A=btoa(_);this.loading=!0,S.post(this.is_admin==1?route("test.user.point.paymentExecute"):route("user.point.paymentExecute"),{pay_type:"Googlepay",order_id:t.id,access_id:t.access_id,method:"1",token:A}).then(C=>{C.data.status==0?u(C.data.message):window.location.href=C.data.redirect_uri,this.loading=!1})}catch(p){console.error(p)}},g=Object.assign({},n);g.allowedPaymentMethods=[h],s.isReadyToPay(g).then(p=>{if(p.result){const _=document.getElementById("googlepay_container");_.innerHTML="",y(_,m)}}).catch(p=>{console.error(p)})}},mounted(){}},K={class:"min-h-screen bg-gradient-to-b from-sky-50 to-white py-8 px-4"},W={class:"max-w-md mx-auto"},X={class:"-mt-4 mb-4"},Z={class:"w-8 h-8 flex items-center justify-center rounded-full bg-white shadow-sm group-hover:bg-sky-50 transition-colors"},Q=e("span",{class:"text-sm font-medium"},"\u30DD\u30A4\u30F3\u30C8\u4E00\u89A7\u306B\u623B\u308B",-1),$={class:"bg-white rounded-2xl shadow-lg overflow-hidden"},ee={key:0,class:"p-6"},te={class:"text-center mb-8"},oe=e("div",{class:"inline-block bg-sky-50 rounded-full px-4 py-1.5 mb-4"},[e("span",{class:"text-sky-600 text-sm font-medium"},"\u30DD\u30A4\u30F3\u30C8\u8CFC\u5165")],-1),ne={class:"text-2xl font-bold text-gray-900 mb-2"},se={key:0,class:"inline-flex items-center gap-1.5 bg-rose-50 text-rose-600 px-3 py-1 rounded-full"},ae=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z","clip-rule":"evenodd"})],-1),ie={class:"text-sm font-medium"},re={class:"bg-gradient-to-r from-sky-500 to-sky-600 rounded-xl p-6 mb-8 text-center"},ce=e("div",{class:"text-white/80 text-sm mb-1"},"\u304A\u652F\u6255\u3044\u91D1\u984D",-1),de={class:"text-white text-3xl font-bold"},le={class:"space-y-3 mb-6"},pe=["onClick"],me={class:"font-medium text-gray-900"},ue={key:0,class:"grid grid-cols-3 grid-rows-2 gap-1 w-24 h-10"},he=e("img",{src:"/images/credit_cards/visa.svg",alt:"Visa"},null,-1),ye=e("img",{src:"/images/credit_cards/master.svg",alt:"Mastercard"},null,-1),ge=e("img",{src:"/images/credit_cards/jcb.svg",alt:"JCB"},null,-1),_e=e("img",{src:"/images/credit_cards/amex.svg",alt:"American Express"},null,-1),be=e("img",{src:"/images/credit_cards/diners.svg",alt:"Diners Club"},null,-1),fe=e("img",{src:"/images/credit_cards/discover.svg",alt:"Discover"},null,-1),we=[he,ye,ge,_e,be,fe],ke={key:1,src:"/images/payments/amazon-pay.png",alt:"Amazon Pay",class:"w-24 h-10 object-contain"},Pe={key:2,src:"/images/payments/apple-pay.png",alt:"Apple Pay",class:"w-24 h-10 object-contain"},xe={key:3,src:"/images/payments/paypay.png",alt:"PayPay",class:"w-24 h-10 object-contain"},ve={key:4,src:"/images/payments/konbini.png",alt:"Konbini",class:"w-36 h-10 object-contain"},Ae={key:5,src:"/images/payments/bank.png",alt:"Bank Transfer",class:"w-24 h-10 object-contain"},Ce={key:6,src:"/images/payments/google-pay.svg",alt:"Google Pay",class:"w-24 h-10 object-contain"},Se={class:"bg-gray-50 rounded-xl p-4 mb-6"},Me={class:"flex items-start gap-3 cursor-pointer"},Le={class:"text-sm text-gray-600"},Te=["href"],Ne=["disabled"],je={key:1,class:"text-center p-6",id:"applepay_container"},Ee={key:2,class:"text-center p-6",id:"amazonpay_container"},Ie={key:3,class:"text-center p-6",id:"googlepay_container"};function Re(t,s,n,x,r,c){const w=b("Head"),k=b("ArrowLeftIcon"),v=b("Link"),h=b("Loading"),l=b("AdminLayout");return a(),i(L,null,[f(w,{title:"\u6C7A\u6E08\u767B\u9332"}),f(l,null,{default:M(()=>[e("div",K,[e("div",W,[e("div",X,[f(v,{href:t.route("user.point"),class:"inline-flex items-center gap-2 text-neutral-600 hover:text-sky-600 transition-colors group"},{default:M(()=>[e("div",Z,[f(k,{class:"w-5 h-5"})]),Q]),_:1},8,["href"])]),e("div",$,[r.payment_stage=="register"?(a(),i("div",ee,[e("div",te,[oe,e("h2",ne,P(c.format_number(n.point.point))+" \u30DD\u30A4\u30F3\u30C8 ",1),n.rank&&n.rank.pt_rate>0?(a(),i("div",se,[ae,e("span",ie,"+"+P(c.format_number(n.point.point*n.rank.pt_rate/100))+" \u30DC\u30FC\u30CA\u30B9",1)])):d("",!0)]),e("div",re,[ce,e("div",de," \xA5"+P(n.point.amount.toLocaleString()),1)]),e("form",{onSubmit:s[1]||(s[1]=j((...o)=>c.handleSubmit&&c.handleSubmit(...o),["prevent"]))},[e("div",le,[(a(!0),i(L,null,E(n.supported_pay_type,o=>(a(),i("div",{key:o},[e("button",{type:"button",onClick:y=>c.selectPaymentMethod(o),class:I([{"ring-2 ring-sky-500 bg-sky-50":r.selectedMethod===o,"hover:bg-gray-50":r.selectedMethod!==o},"w-full px-4 py-3 bg-white border border-gray-200 rounded-xl flex justify-between items-center transition-all duration-200 hover:shadow-sm"])},[e("span",me,P(r.pay_type_titles[o]),1),o==="Card"?(a(),i("div",ue,we)):d("",!0),o==="amazonpay"?(a(),i("img",ke)):d("",!0),o==="Applepay"?(a(),i("img",Pe)):d("",!0),o==="Paypay"?(a(),i("img",xe)):d("",!0),o==="Konbini"?(a(),i("img",ve)):d("",!0),o==="Virtualaccount"?(a(),i("img",Ae)):d("",!0),o==="Googlepay"?(a(),i("img",Ce)):d("",!0)],10,pe)]))),128))]),e("div",Se,[e("label",Me,[R(e("input",{type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=o=>r.agreeTerms=o),class:"mt-1 focus:ring-sky-500 rounded border-gray-300 text-sky-600"},null,512),[[B,r.agreeTerms]]),e("span",Le,[z(" \u500B\u4EBA\u60C5\u5831\u306E\u53D6\u308A\u6271\u3044\u306B\u540C\u610F\u3059\u308B "),e("a",{href:t.route("main.privacy_police"),class:"text-sky-600 hover:text-sky-700 font-medium"},"\u53D6\u308A\u6271\u3044\u306E\u8A73\u7D30\u3092\u78BA\u8A8D\u3059\u308B",8,Te)])])]),e("button",{type:"submit",disabled:r.selectedMethod==null,class:"w-full py-4 bg-gradient-to-r from-sky-500 to-sky-600 text-white rounded-xl text-lg font-semibold transition-all duration-200 hover:from-sky-600 hover:to-sky-700 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm hover:shadow-md"}," \u652F\u6255\u3044\u3092\u9032\u3081\u308B ",8,Ne)],32)])):d("",!0),f(h,{show:r.loading},null,8,["show"]),r.payment_stage=="Applepay"?(a(),i("div",je)):d("",!0),r.payment_stage=="amazonpay"?(a(),i("div",Ee)):d("",!0),r.payment_stage=="Googlepay"?(a(),i("div",Ie)):d("",!0)])])])]),_:1})],64)}const He=G(F,[["render",Re]]);export{He as default};
